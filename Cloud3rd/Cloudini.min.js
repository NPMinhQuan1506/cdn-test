function GD_DetectUsing(){try{if(Sys_LibName.length>0){GD_CloudUsed=!0;let n=Sys_LibName.filter(n=>n.TransferEdge.toLowerCase()=="custimage");GD_CloudCust=n.length!=0?!0:!1}else GD_CloudUsed=!1}catch(n){GD_CloudUsed=!1}}function Cloud_Ini(){GD_CloudUsed&&$("#MS_CloudInfo").removeClass("d-none")}function GD_gapiLoaded(){}function GD_gisLoaded(){}function GD_SignOut(){try{setCookie("GAccesstoken","",0);setCookie("GRefreshToken","",0);author_set("GoogleInfo","");typeof CloudStatus_Checking=="function"&&CloudStatus_Checking();typeof CustFolder_CurrentClick=="function"&&CustFolder_CurrentClick()}catch(n){}}function GD_RefreshToken(n,t){let i=getCookie("GAccesstoken"),r=getCookie("GRefreshToken");i!=undefined&&i!=""&&r!=undefined&&r!=""?AjaxJWT(url="/Api/Google/RefreshToken",data=JSON.stringify({GAccesstoken:i,GRefreshToken:r}),async=!0,success=function(i){i!=undefined&&i!=""?(setCookie("GAccesstoken",i,365),n()):t()},error=function(){t()}):t()}async function GD_LoginSuccessFromCloud(n){await new Promise(t=>{setTimeout(()=>{let i=JSON.parse(n);if(i!=undefined){let n=i.userid;Number(n)==Number(sys_userID_Main)&&setTimeout(()=>{typeof CloudStatus_Checking=="function"&&(CloudStatus_Checking(),window.location.reload()),typeof fbu_CheckingAuthor=="function"&&fbu_CheckingAuthor(),typeof CustFolder_CurrentClick=="function"&&CustFolder_CurrentClick()},1e3)}t()})})}async function Driver_GetCurrentInfo(n,t){return new Promise(i=>{try{let r=getCookie("GAccesstoken");r!=undefined&&r!=""?$.ajax({url:"https://www.googleapis.com/drive/v3/about?fields=user",type:"GET",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+r)},"async":!0,contentType:"application/json; charset=utf-8",success:function(i){i!=undefined&&i?.user!=undefined?(author_set("GoogleInfo",JSON.stringify(i.user)),n(i)):GD_RefreshToken(n,t)},error:function(){GD_RefreshToken(n,t)}}):t!=undefined&&t();i()}catch(r){t()}})}async function Driver_GetPermissionOnFile(n,t,i){try{return new Promise(r=>{let u=getCookie("GAccesstoken");u!=undefined&&u!=""?$.ajax({url:`https://www.googleapis.com/drive/v3/files/${n}/permissions?fields=permissions(emailAddress,role)`,type:"GET",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+u)},"async":!0,contentType:"application/json; charset=utf-8",success:function(n){t!=undefined&&t(n)},error:function(){i!=undefined&&i()}}):i!=undefined&&i();r()})}catch(r){i!=undefined&&i()}}async function Driver_GetPermissionOnFolder(n,t,i){try{return new Promise(r=>{let u=getCookie("GAccesstoken");u!=undefined&&u!=""?$.ajax({url:`https://www.googleapis.com/drive/v3/files/${n}/permissions?fields=permissions(id,emailAddress,role,displayName,photoLink)&supportsAllDrives=true`,type:"GET",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+u)},"async":!0,contentType:"application/json; charset=utf-8",success:function(n){t!=undefined&&t(n)},error:function(){i!=undefined&&i()}}):i!=undefined&&i();r()})}catch(r){i!=undefined&&i()}}async function Driver_PostPermissionOnFolder(n,t,i,r,u){try{return new Promise(f=>{let e=getCookie("GAccesstoken");e!=undefined&&e!=""?$.ajax({url:`https://www.googleapis.com/drive/v3/files/${n}/permissions?supportsAllDrives=true&sendNotificationEmail=true`,type:"POST",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+e);n.setRequestHeader("Content-Type","application/json")},data:JSON.stringify({role:i,type:"user",emailAddress:t}),"async":!0,success:function(n){r!=undefined&&r(n)},error:function(n,t,i){console.error("Lỗi khi thêm quyền:",i);u!=undefined&&u()}}):u!=undefined&&u();f()})}catch(f){u!=undefined&&u()}}async function Driver_RemovePermissionFromFolder(n,t,i,r){try{return new Promise(u=>{let f=getCookie("GAccesstoken");f!=undefined&&f!=""?$.ajax({url:`https://www.googleapis.com/drive/v3/files/${n}/permissions/${t}?supportsAllDrives=true`,type:"DELETE",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+f)},"async":!0,success:function(n){i!=undefined&&i(n)},error:function(n,t,i){console.error("Lỗi khi xóa quyền:",i);r!=undefined&&r()}}):r!=undefined&&r();u()})}catch(u){r!=undefined&&r()}}async function Driver_GetMetafile(n,t,i){$.ajax({url:"https://www.googleapis.com/drive/v3/files/"+n,type:"GET",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+t)},"async":!0,contentType:"application/json; charset=utf-8",success:function(n){i(n)},error:function(){}})}function Driver_GenThumbnail(n){return`https://lh3.googleusercontent.com/d/${n}=w1000?authuser=0`}function Driver_GenLink(n){return`https://lh3.googleusercontent.com/d/${n}=w1000?authuser=0`}function Driver_GenFileLink(n){return`https://drive.google.com/file/d/${n}/view?usp=drive_link`}var GD_CloudUsed=!1,GD_CloudValid=!1,GD_CloudCust=!1;GD_DetectUsing();