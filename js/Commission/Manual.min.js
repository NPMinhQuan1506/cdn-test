function RevenueManual({DateFrom:i,DateTo:r,BranchID:n,MyLoad:e=0,CurrentMaster:t=0,MAXDATE:f=31,LIMITLOAD:u=7e4,fnSetting_Before:v,fnSetting_Complete:y,fnMaster_Before:c,fnMaster_Complete:l,fnMaster_CountComplete:a,fnDetail_Before:o,fnDetail_Complete:s,fnDetail_CountComplete:h,ver:p="0"}){RevenueManual.prototype.settings=this;this.DateFrom=i;this.DateTo=r;this.BranchID=n;this.MyLoad=e;this.CurrentMaster=0;this.MAXDATE=f;this.LIMITLOAD=u;this.XhrRevenueLoad=null;this.IsDocDevide=0;this.IsDocGreater=0;this.IsDocExCost=0;this.IsDocTreatDevide=0;this.IsDocTreatExCost=0;this.IsAssDevide=0;this.IsAssGreater=0;this.IsAssTreatDevide=0;this.IsTeleFirst=0;this.IsTeleExProduct=0;this.IsConDevide=0;this.IsCSKHExFirst=0;this.IsSuppDevide=0;this.DataRevMaster=[];this.DataRevDetail=[];this.fnSetting_Before=v;this.fnSetting_Complete=y;this.fnMaster_Before=c;this.fnMaster_Complete=l;this.fnMaster_CountComplete=a;this.fnDetail_Before=o;this.fnDetail_Complete=s;this.fnDetail_CountComplete=h;this.Ver=p??Math.floor(Math.random()*1e3);this.Init=function(){let n=RevenueManual.prototype.settings;n.LoadData_Prepare_Report()};this.LoadData_Prepare_Report=function(){try{let n=RevenueManual.prototype.settings;AjaxJWT(url="/api/Commission/RevenueSettings?ver="+n.Ver,data={},async=!0,success=function(t){let i=[];if(t!=""&&t!="null"){i=JSON.parse(t);let r=i[0];n.IsDocDevide=Number(r.Doc_Devide);n.IsDocGreater=Number(r.Doc_Greater);n.IsDocExCost=Number(r.Doc_ExCost)>0?1:0;n.IsDocTreatDevide=Number(r.Docnomoney_Devide);n.IsDocTreatExCost=Number(r.DocTreat_ExCost)>0?1:0;n.IsAssDevide=Number(r.KTVPTM_Devide);n.IsAssGreater=Number(r.KTVPTM_Greater);n.IsTeleFirst=Number(r.TeleSale_First);n.IsTeleExProduct=Number(r.TeleSale_ExProduct);n.IsConDevide=Number(r.Consult_Devide);n.IsCSKHExFirst=Number(r.Cskh_Exfirst);n.IsSuppDevide=Number(r.Support_Devide)}typeof n.fnSetting_Complete=="function"&&n.fnSetting_Complete();n.LoadData_Report()},before=function(){typeof n.fnSetting_Before=="function"&&n.fnSetting_Before()})}catch(n){}};this.LoadData_Report=function(){let n=RevenueManual.prototype.settings,{BranchID:i,DateFrom:r,DateTo:u,MyLoad:f,MAXDATE:e}=n,o=r+" to "+u,t={};return t.date=o,t.maxdate=e,t.branch=i,AjaxJWT(url="/api/Commission/RevManual_LoadData",data=JSON.stringify(t),async=!0,success=function(t){if(t!=""&&t!="null"&&t!="0"&&f!=1){let i=JSON.parse(t);typeof n.RevenueMaster_Count=="function"&&n.RevenueMaster_Count(i.Table)}typeof n.fnMaster_Complete=="function"&&n.fnMaster_Complete(t)},before=function(){typeof n.fnMaster_Before=="function"&&n.fnMaster_Before()}),!1};this.RevenueMaster_Count=async function(n){new Promise(t=>{let i=RevenueManual.prototype.settings;i.DataRevMaster=[];let r=[];if(n&&n.length>0)for(let t=0;t<n.length;t++){if(n[t].EMP1!=0){let i={};i.emp=n[t].EMP1;i.commission=n[t].Commission1;i.realamount=n[t].Commission1;r.push(i)}if(n[t].EMP2!=0){let i={};i.emp=n[t].EMP2;i.commission=n[t].Commission2;i.realamount=n[t].Commission2;r.push(i)}if(n[t].EMP3!=0){let i={};i.emp=n[t].EMP3;i.commission=n[t].Commission3;i.realamount=n[t].Commission3;r.push(i)}}var f=[];let u=0;r.reduce(function(n,t){return n[t.emp]||(u=u+1,n[t.emp]={stt:u,emp:t.emp,realamount:0,commission:0,empName:i.RevenueDetail_EmpName(t.emp)},f.push(n[t.emp]),i.DataRevMaster.push(n[t.emp])),n[t.emp].commission+=t.commission,n[t.emp].realamount+=t.realamount,n},{});typeof i.fnMaster_CountComplete=="function"&&i.fnMaster_CountComplete(f);t()})};this.RevenueDetail_Load=function(n){let t=RevenueManual.prototype.settings;t.CurrentMaster=n;let{BranchID:u,DateFrom:f,DateTo:e,MAXDATE:o,LIMITLOAD:s,XhrRevenueLoad:r}=t;r&&r.readyState!=4&&r.abort();let h=f+" to "+e,i={};return i.date=h,i.maxdate=o,i.limit=s,i.empid=t.CurrentMaster,i.branch=u,r=AjaxJWT(url="/api/Commission/RevManual_LoadDetail",data=JSON.stringify(i),async=!0,success=function(n){if(typeof t.fnDetail_Complete=="function"&&t.fnDetail_Complete(n),n!="0"){let i=JSON.parse(n),r=i.Table,u=i.Table1,f=i.Table2,e=i.Table3,o=[].concat(r,u,f,e);t.RevenueDetail_Count(o)}},before=function(){typeof t.fnDetail_Before=="function"&&t.fnDetail_Before()}),!1};this.RevenueDetail_Count=async function(n){new Promise(t=>{let i=RevenueManual.prototype.settings;i.DataRevDetail=[];let{CurrentMaster:f}=i,r=0,u=0;if(n&&n.length>0){for(let t=0;t<n.length;t++)f!=0?n[t].Manual_Revenue==1&&(n[t].Emp1==f&&i.RevenueDetail_Push(n[t],"Emp1","RealAmount1",r,u),n[t].Emp2==f&&i.RevenueDetail_Push(n[t],"Emp2","RealAmount2",r,u),n[t].Emp3==f&&i.RevenueDetail_Push(n[t],"Emp3","RealAmount3",r,u)):n[t].Manual_Revenue==1&&(n[t].Emp1!=0&&i.RevenueDetail_Push(n[t],"Emp1","RealAmount1",r,u),n[t].Emp2!=0&&i.RevenueDetail_Push(n[t],"Emp2","RealAmount2",r,u),n[t].Emp3!=0&&i.RevenueDetail_Push(n[t],"Emp3","RealAmount3",r,u));typeof i.fnDetail_CountComplete=="function"&&i.fnDetail_CountComplete(JSON.parse(JSON.stringify(i.DataRevDetail)))}t()})};this.RevenueDetail_Push=function(n,t,i,r,u){try{let f=JSON.parse(JSON.stringify(n)),e=RevenueManual.prototype.settings;f.RealAmount=n.Manual_Revenue==0?r:n[i];f.Commission=n.Manual_Revenue==0?u:n[i];f.Emp=n[t];f.Empname=e.RevenueDetail_EmpName(n[t]);f.Empcode=e.RevenueDetail_EmpCode(n[t]);e.DataRevDetail.push(f)}catch(f){}};this.ExportMaster=async function(n){let t=RevenueManual.prototype.settings,i={stt:"STT",empName:Outlang.Nhan_vien,realamount:Outlang.Tong_tien},r=n!=""?n:Outlang.Doanh_thu_tong_ky_thuat_vien;await exportJsonToExcel(r,t.DataRevMaster,i)};this.ExportDetail=async function(n,t,i){let e=RevenueManual.prototype.settings,r=t==0,u=$("#"+i||""),f={CustCode:Outlang.Ma_khach_hang,CustName:Outlang.Khach_hang,SourceID:{isShow:r||u.find(`.shtoogle[data-name='Source']`).is(":checked"),data:[Outlang.Sys_nguon_khach_hang,n=>Fun_GetName_ByID(RP_DataCustomerSource,n)]},DocCode:{isShow:r||u.find(`.shtoogle[data-name='DocCode']`).is(":checked"),data:Outlang.Ma_ho_so},CustPhone:{dataNamePer:"CustPhone",isShow:r||u.find(`.shtoogle[data-name='CustPhone']`).is(":checked"),data:[Outlang.So_dien_thoai]},CustCodeOld:{isShow:r||u.find(`.shtoogle[data-name='CusCodeOld']`).is(":checked"),data:Outlang.Ma_khach_hang_cu!=undefined?Outlang.Ma_khach_hang_cu:"Mã khách hàng cũ"},CustAge:{isShow:r||u.find(`.shtoogle[data-name='CustAge']`).is(":checked"),data:Outlang.Tuoi!=undefined?Outlang.Tuoi:"Tuổi"},CustGender:{isShow:r||u.find(`.shtoogle[data-name='CustGender']`).is(":checked"),data:[Outlang.Gioi_tinh,(n,{CustGender:t})=>t==60?Outlang.Sys_nam:Outlang.Sys_nu1]},CustAddress:{dataNamePer:"CustAddress",isShow:r||u.find(`.shtoogle[data-name='CustAddress']`).is(":checked"),data:[Outlang.Sys_dia_chi_khach_hang1]},CustCommuneID:{dataNamePer:"CustCommu",isShow:r||u.find(`.shtoogle[data-name='CustCommu']`).is(":checked"),data:[Outlang.Phuong_xa??"Phường xã",n=>Fun_GetName_ByID(RP_DataCommune,n)]},CustDistrictID:{dataNamePer:"CustDistrict",isShow:r||u.find(`.shtoogle[data-name='CustDistrict']`).is(":checked"),data:[Outlang.Quan_huyen??"Quận huyện",n=>Fun_GetName_ByID(RP_DataDistrict,n)]},CustCityID:{dataNamePer:"CustCity",isShow:r||u.find(`.shtoogle[data-name='CustCity']`).is(":checked"),data:[Outlang.Sys_thanh_pho??"Thành phố",n=>Fun_GetName_ByID(RP_DataCity,n)]},SerCode:{isShow:r||u.find(`.shtoogle[data-name='ServiceCode']`).is(":checked"),data:Outlang.Ma_dich_vu!=undefined?Outlang.Ma_dich_vu:"Mã dịch vụ"},ServiceID:[Outlang.Dich_vu,n=>e.RevenueDetail_ServiceName(0,n)],SaleCode:{isShow:r||u.find(`.shtoogle[data-name='SaleCode']`).is(":checked"),data:Outlang.Ma_len_don},Quantity:Outlang.Sl??"Sl",Price_Root:Outlang.Gia_ban_dau??"Giá ban đầu",Price:Outlang.Thanh_tien,Empname:Outlang.Nhan_vien,Empcode:{isShow:r||u.find(`.shtoogle[data-name='EmpCode']`).is(":checked"),data:Outlang.Ma_nhan_vien??"Mã nhân viên"},Commission:Outlang.Hoa_hong,RePercent:{isShow:r||u.find(`.shtoogle[data-name='RePercent']`).is(":checked"),data:["% "+(Outlang.Thuc_lanh??"Thực lãnh"),n=>n!=0?n:100]},RealAmount:Outlang.Thuc_lanh??"Thực lãnh",ServiceType:{isShow:r||u.find(`.shtoogle[data-name='ServiceCat']`).is(":checked"),data:Outlang.Nhom_dich_vu},PaymentService:Outlang.Sys_thanh_toan,Date:{isShow:r||u.find(`.shtoogle[data-name='DateService']`).is(":checked"),data:[Outlang.Ngay_tao_dich_vu,n=>SysDate().FUTC(n).DateText()]},DatePaid:[Outlang.Ngay_thanh_toan,n=>SysDate().FUTC(n).DateText()],BranchName:{isShow:r||u.find(`.shtoogle[data-name='Branch']`).is(":checked"),data:Outlang.Chi_nhanh},IsNew:{isShow:r||u.find(`.shtoogle[data-name='CusNew']`).is(":checked"),data:[Outlang.Khach_hang_moi??"Khách hàng mới",n=>n==1?"new":""]},TypeCom:[Outlang.Loai_hoa_hong??"Loại hoa hồng",n=>decodeHtml(RevenueDetail_TypeCommission(n))],Manual_Revenue:{isShow:r||u.find(`.shtoogle[data-name='Manual_Revenue']`).is(":checked"),data:[Outlang.Thu_cong,n=>n!=0?"x":""]},Note:{isShow:r||u.find(`.shtoogle[data-name='CusNew']`).is(":checked"),data:[Outlang.Ghi_chu_hoa_hong]}};f=Checking_TabControl_System_RebuildHeader(f,tableBodyId="dtContentReportBody",PermissionTable_TabControl);let o=n!=""?n:Outlang.Doanh_thu;await exportJsonToExcel(o,e.DataRevDetail,f)};this.RevenueDetail_ServiceName=function(n,t){try{return n!=0?RP_DataCard[n].Name:RP_DataService[t].Name}catch(i){return""}};this.RevenueDetail_TypeCommission=function(n){try{let t="";switch(n){case 1:t=Outlang.Sys_tu_van;break;case 2:t="Telesale";break;case 3:t=Outlang.Sys_the;break;case 4:t=Outlang.Bac_si;break;case 5:t="KTV";break;default:t=""}return t}catch(t){return""}};this.RevenueDetail_ServiceType=function(n){try{let t="";switch(n){case 0:t=Outlang.Dich_vu??"Dịch vụ";break;case 1:t=Outlang.San_pham??"Sản phẩm";break;case 2:t=Outlang.The??"Thẻ"}return t}catch(t){return""}};this.RevenueDetail_EmpName=function(n){try{return RP_DataEmployee[n]!=undefined?RP_DataEmployee[n].Name:""}catch(t){return""}};this.RevenueDetail_EmpCode=function(n){try{return RP_DataEmployee[n]!=undefined?RP_DataEmployee[n].Code:""}catch(t){return""}}}