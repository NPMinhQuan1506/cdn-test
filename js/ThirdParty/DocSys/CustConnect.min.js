async function APIDSFeedBack_LoadList(n=5,t=0,i=0,r,u,f,e){typeof r=="function"&&r();new Promise(r=>{setTimeout(()=>{try{AjaxJWT(url="/api/DocSys/GetFeedBack",data=JSON.stringify({limit:n,beginid:t,currentid:i}),async=!0,success=function(n){n!="0"?typeof u=="function"&&u(n):typeof f=="function"&&f();r(n);typeof e=="function"&&e()})}catch(o){r();typeof e=="function"&&e();typeof f=="function"&&f()}},100)})}async function APIDSRoadMap_LoadList(n=5,t=0,i,r,u,f){typeof i=="function"&&i();new Promise(i=>{setTimeout(()=>{try{AjaxJWT(url="/api/DocSys/GetRoadMap",data=JSON.stringify({limit:n,beginid:t}),async=!0,success=function(n){n!="0"?typeof r=="function"&&r(n):typeof u=="function"&&u();i(n);typeof f=="function"&&f()})}catch(e){i();typeof f=="function"&&f();typeof u=="function"&&u()}},100)})}async function APIDSRoadMap_Read(n=0,t=0,i="",r="",u="20230101000000",f,e,o,s){typeof f=="function"&&f();new Promise(f=>{setTimeout(()=>{try{AjaxJWT(url="/api/DocSys/ReadRoadMap",data=JSON.stringify({userid:n,roadmapid:t,username:i,empname:r,timeread:u}),async=!0,success=function(n){n!="0"?typeof e=="function"&&e(n):typeof o=="function"&&o();f(n);typeof s=="function"&&s()})}catch(h){f();typeof s=="function"&&s();typeof o=="function"&&o()}},100)})}async function APIDSRoadMap_CheckIsReaded(n=0,t,i,r,u){typeof t=="function"&&t();new Promise(t=>{setTimeout(()=>{try{AjaxJWT(url="/api/DocSys/CheckIsReaded",data=JSON.stringify({userid:n}),async=!0,success=function(n){n!="0"?typeof i=="function"&&i(n):typeof r=="function"&&r();t(n);typeof u=="function"&&u()})}catch(f){t();typeof u=="function"&&u();typeof r=="function"&&r()}},100)})}async function Master_CustConnect_Init(){if(Sys_AllowNotiNewFeatures!=1){$("#MS_NewFeatureToast").remove();return}Master_CustFeat_Settings();Master_CustFeat_EventInit()}function Master_CustFeat_Settings(){css_require("/css/custconnect.css");let n=localstorage_get("NewFeat_Position");if(sys_isMobile==1)$("#MS_NewFeatureToast").css({top:window.innerHeight-$("#MS_NewFeatureToast").height()});else if(n!=""&&sys_isMobile==0){let t=JSON.parse(n)?.data;isNaN(Number(t))||$("#MS_NewFeatureToast").css({top:t})}let t=localstorage_get("NewFeat_Collapse");if(t!=""){let n=JSON.parse(t)?.data;n==!0?$("#MS_NewFeatureToast").addClass("collapses"):$("#MS_NewFeatureToast").removeClass("collapses")}else sys_isMobile==1?$("#MS_NewFeatureToast").addClass("collapses"):$("#MS_NewFeatureToast").removeClass("collapses");$(document).on("click",function(n){let t=$(".fixed-plugin[data-item]");$(t).is(n.target)||$(t).has(n.target).length!==0||$(".fixed-plugin[data-item]").removeClass("show")});APIDSRoadMap_CheckIsReaded(sys_userID_Main,beforefunc=function(){},successfunc=function(n){let t=JSON.parse(n);if(t&&t.length!=0){let{HasNewRM:n,HasNewFB:i}=t[0];n!=undefined&&n==1&&$('.MS_NewFeatureToast_Item[data-item="newfeat"]').addClass("active");i!=undefined&&i==1&&$('.MS_NewFeatureToast_Item[data-item="feedback"]').addClass("active");Master_CustFeat_CheckNoti()}},failurefunc=function(){},completefunc=function(){})}function Master_CustFeat_EventInit(){$("#MS_NewFeatureToast .MS_NewFeatureToast_Collapse").unbind("click").on("click",function(n){(n.preventDefault(),n.stopPropagation(),$(this).data("dragging"))||($("#MS_NewFeatureToast").toggleClass("collapses"),localstorage_set("NewFeat_Collapse",$("#MS_NewFeatureToast").hasClass("collapses")))});$("#MS_NewFeatureToast .MS_NewFeatureToast_Item").unbind("click").on("click",function(n){n.preventDefault();n.stopPropagation();let t=$(this).attr("data-item");switch(t){case"newfeat":$('.fixed-plugin[data-item="newfeat"]').addClass("show");Master_NewFeature_Init();break;case"feedback":$('.fixed-plugin[data-item="feedback"]').addClass("show");Master_FeedBack_Init()}});$("#MS_NewFeatureToast").draggable({handle:".MS_NewFeatureToast_Collapse",axis:"y",start:function(){},drag:function(n,t){var i=t.position.top,r=0,u=window.innerHeight-$("#MS_NewFeatureToast").height();i<r&&(t.position.top=r);i>u&&(t.position.top=u);$(n.target).data("dragging",!0)},stop:function(n,t){$(n.target).data("dragging",!1);localstorage_set("NewFeat_Position",t.position.top)}});ToolPopper()}function Master_NewFeature_Init(){Master_NewFeature_Load()}function Master_FeedBack_Init(){$('.MS_NewFeatureToast_Item[data-item="feedback"]').removeClass("active");Checking_TabControl_Permission();Master_NewFeature_Read(0);Master_FeedBack_Load()}async function Master_NewFeature_Load(){APIDSRoadMap_LoadList(limit=20,begin=0,beforefunc=function(){$("#MS_NewFeatureWaiting").show();$("#MS_NewFeature,#MS_NewFeatureEmpty").hide()},successfunc=function(n){let t=JSON.parse(n);t&&t.length!=0?($("#MS_NewFeature").show(),$("#MS_NewFeatureEmpty").hide(),Master_NewFeature_Render(t,"MS_NewFeature")):($("#MS_NewFeature").hide(),$("#MS_NewFeatureEmpty").show())},failurefunc=function(){},completefunc=function(){$("#MS_NewFeatureWaiting").hide()})}async function Master_FeedBack_Load(){($("#MS_FeedBack")?.length??0)>0?APIDSFeedBack_LoadList(limit=20,begin=0,currentid=0,beforefunc=function(){$("#MS_FeedBackWaiting").show();$("#MS_FeedBack,#MS_FeedBackEmpty").hide()},successfunc=function(n){let t=JSON.parse(n);t&&t.length!=0?($("#MS_FeedBack").show(),$("#MS_FeedBackEmpty").hide(),Master_FeedBack_Render(t,"MS_FeedBack")):($("#MS_FeedBack").hide(),$("#MS_FeedBackEmpty").show())},failurefunc=function(){},completefunc=function(){$("#MS_FeedBackWaiting").hide()}):$("#MS_FeedBackEmpty").show()}async function Master_NewFeature_Read(n){try{APIDSRoadMap_Read(sys_userID_Main,n,sys_userName_Main,sys_employeeName_Main,SysDate().FNOW().UTC_DTFullNum())}catch{}}async function Master_NewFeature_Render(n,t){return new Promise(()=>{setTimeout(()=>{var i=document.getElementById(t);if(i!=null){if(i.innerHTML="",n&&n.length!=0)for(let t=0;t<n.length;t++){let r=n[t],u=`
                                    <div class="mb-3 itemfeat cursor-pointer itemfeat_${t}" data-href="${r.Url}" data-roadmap="${r.ID}">
                                        <div class="lazy" data-src="${r.Image}"></div>
                                        <div class="itemfeat-content" style="display: none;">
                                            <div>
                                                <img class="itemfeat-image card-img-top rounded-2">
                                            </div>
                                            <div class="card-body p-2 px-0 pt-3">
                                                <h5 class="fw-bold text-sm itemfeat-title">
                                                    <span class="ellipsis_two_line">${r.Title}</span>
                                                </h5>
                                                <p class="text-secondary text-sm mb-1 ellipsis_three_line itemfeat-desc">
                                                    ${r.Description??""}
                                                </p>
                                                <a href="${r.Url}" class="icon-move-right text-primary text-sm">
                                                    <span>${Outlang.Chi_tiet}</span>
                                                    <i class="fas fa-arrow-right text-xs ms-1" aria-hidden="true"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="skeleton">
                                            <div data-skeleton class="w-100 rounded-2" style="aspect-ratio: 4/3;"></div>
                                            <div data-skeleton class="mt-3" style="--skeleton-lines: 3"></div>
                                            <div data-skeleton class="mt-3" style="--skeleton-lines: 2"></div>
                                            <div data-skeleton class="mt-3" style="width:60px;height: 0.7lh" ></div>
                                        </div>
                                    </div>
                                `;i.insertAdjacentHTML("beforeend",u)}Master_NewFeature_Event(t)}},10)})}async function Master_FeedBack_Render(n,t){return new Promise(()=>{setTimeout(()=>{var i=document.getElementById(t);if(i!=null&&(i.innerHTML="",n&&n.length!=0))for(let t=0;t<n.length;t++){let r=n[t],u=`
                                    <div class="itemfeedback cursor-pointer itemfeedback_${t}" data-href="${r.Url}" data-roadmap="${r.ID}">
                                        <div class="">
                                            <div class="card-body p-2 px-0">
                                                <h5 class="fw-bold text-sm itemfeat-title">
                                                    <a class="text-primary ellipsis_two_line" target="_blank" href="https://vttechsolution.com/feedback/feedbackpublic?uid=${r.ID}">
                                                        ${r.StatusName!=""?`<span class="text-sm" style="color:${r.StatusBgColor} ">${r.StatusName}</span>`:""}
                                                        <span class="text-dark">${r.Title}</span>
                                                    </a>
                                                </h5>
                                                <p class="text-dark text-sm mb-1 ellipsis_three_line">
                                                    ${r.Content??""}
                                                </p> 
                                                <div class="d-flex flex-column text-sm text-dark" >
                                                    <div>
                                                        <span>Ngày nhận</span>: ${SysDate().FUTC(r.DateReceipt).DateText()}
                                                    </div>
                                                    ${r.DateExpect.includes("1900-01-01")?``:`<div>
                                                            <span>Ngày dự kiến</span>: ${SysDate().FUTC(r.DateExpect).DateText()}
                                                        </div>`}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr/>
                                `;i.insertAdjacentHTML("beforeend",u)}},10)})}function Master_NewFeature_Event(n){$("#"+n+" .itemfeat").unbind("click").on("click",function(n){n.preventDefault();n.stopPropagation();let t=$(this).attr("data-href")??"",i=$(this).attr("data-roadmap")??"";t!=""&&(window.open(t,"_blank"),$("#MS_NewFeatureToast .MS_NewFeatureToast_Item").removeClass("active"),$("#MS_NewFeatureToast").removeClass("noti"),Master_NewFeature_Read(i))});const t=document.querySelectorAll(".itemfeat .lazy"),i=(n,t)=>{n.forEach(n=>{if(n.isIntersecting){const r=n.target,u=r.getAttribute("data-src");var i=new Image;i.onload=function(){$(r).siblings(".itemfeat-content").find(".itemfeat-image").attr("src",this.src);let n=$(r).siblings(".itemfeat-content"),t=$(r).siblings(".skeleton");n.show();t.hide()};i.src=u;t.unobserve(r)}})},r=new IntersectionObserver(i,{threshold:.1});t.forEach(n=>{r.observe(n)})}function Master_CustFeat_CheckNoti(){$(".MS_NewFeatureToast_Item.active").length!=0?$("#MS_NewFeatureToast").addClass("noti"):$("#MS_NewFeatureToast").removeClass("noti")}