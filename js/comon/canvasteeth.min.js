function Canele_Pattern(n,t){let r=document.createElement("canvas"),i=r.getContext("2d");return r.width=t,r.height=t,i.fillStyle="transparent",i.strokeStyle=n,i.lineWidth=1,i.fillRect(0,0,r.width,r.height),i.moveTo(0,0),i.lineTo(t,t),i.stroke(),r}function Can_DrawDefault(n,t,i,r,u,f){n.each(function(){var s=this.id,a=this.dataset.name,h=this.dataset.updown,c=this.dataset.sign,v=this.dataset.imgex,l=DendisR_DetectTeethSrc(a,h,c,v),y=DendisR_DetectType(h,c),n=document.getElementById(s),e=n.getContext("2d"),o;n.height=i;n.width=t;o=new Image;o.onload=function(){e.drawImage(o,0,0,t,i);var h=new XMLHttpRequest,c={};h.onreadystatechange=function(){var o,t,i;if(this.readyState==4&&this.status==200){for(o=$.parseXML(this.response),t=$(o).find("path"),i=0;i<t.length;i++){var h=t[i],l=h.id,v=h.getAttribute("d"),a=new Path2D(v);l!=""&&(c[s+"_"+l]={path:a,type:y});Can_DrawReset(e,a)}typeof r!="undefined"&&typeof r=="function"&&r(c);n.addEventListener("click",function(n){for(var o,i,c,s,r=0;r<t.length;r++)if(o=this.getBoundingClientRect(),i=this.dataset.id,i!=undefined){var l=n.clientX-o.left,a=n.clientY-o.top,h=t[r];let v=h.id;if(v!=""&&(c=h.getAttribute("d"),s=new Path2D(c),e.isPointInPath(s,l,a))){let n=v.toString()+"-"+i.toString();TeethSelected[n]!=undefined&&TeethSelected[n]!=""?typeof u!="undefined"&&typeof u=="function"&&u(v,i):(Can_DrawSelected(e,s),typeof f!="undefined"&&typeof f=="function"&&f(v,i))}}})}};h.open("GET",l,!0);h.send()};o.src=l})}function Can_DrawSelected(n,t){n.beginPath();let i=n.createPattern(canpattern,"repeat");n.fillStyle=i;n.strokeStyle="transparent";n.lineWidth=1;n.stroke(t);n.fill(t)}function Can_DrawReset(n,t){n.beginPath();n.strokeStyle="transparent";n.fillStyle="transparent";n.stroke(t);n.fill(t)}function Can_ClearWholeTeeth(n,t){Can_DrawDefault($("#teethcircle_"+n),TeethCircle,TeethCircle,function(){Can_DrawDefault($("#teethface_"+n),TeethWidth,TeethHeight,function(){t()})})}function Can_ClearCircle(n,t){Can_DrawDefault($("#teethcircle_"+n),TeethCircle,TeethCircle,function(){t()})}function Can_ClearRootFace(n,t){Can_DrawDefault($("#teethface_"+n),TeethWidth,TeethHeight,function(){t()})}function DendisR_DetectTeethSrc(n,t,i,r){return t!=undefined&&i!=undefined?`/Canvas/${r}.svg`:"/Canvas/matrang.svg"}function DendisR_DetectType(n,t){return n!=undefined&&t!=undefined?n=="U"?t=="8"?"r3u":"r1u":t=="12"?"r3d":"r1d":"circle"}async function Dendis_GroupDiseaseRender(n,t){new Promise(()=>{var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="";for(let[,t]of Object.entries(n)){let f=t.data,e="",n="",o="",r="";for(i=0;i<f.length;i++){let t=f[i];i==0&&(o=CVT_isVN?DiseaseList[t.Diseaseid].Name:DiseaseList[t.Diseaseid].NameOther||DiseaseList[t.Diseaseid].Name,e=DiseaseCatList[t.Type]?ser_imageFeature_Disease+DiseaseCatList[t.Type].CatImg:Master_Default_Pic);n=CanTeethAreaName[t.Part];n!=""&&(n=`<span class="part pe-1">${CanTeethAreaName[t.Part]}</span>`);r=r+`<span>
                            <span class="px-1">${TeethCollkv[t.Teethid].TeethName}</span>
                            ${n}
                            </span>`}let s=`
                        <td class="vt-number-order"></td>
                         <td>${o}</td>
                        <td>
                            <div class="d-flex">
                                <div class="avatar avatar-xs me-3">
                                    <img src="${e}" alt="kal" class="rounded-0">
                                </div>
                                <div class="d-flex flex-column justify-content-center text-center">
                                    <h6 class="mb-0 text-sm fw-bold  text-dark">${r}</h6>
                   
                                </div>
                            </div>
                        </td>
                       
                       
                    `;u=u+'<tr role="row" class="vt-number">'+s+"<\/tr>"}document.getElementById(t).innerHTML=u}})}async function Dendis_RenderDisease(n,t){new Promise(()=>{var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="";if(n&&n.length>0)for(i=0;i<n.length;i++){let t=n[i],r=CanTeethAreaName[t.Part],f=DiseaseCatList[t.Type]?ser_imageFeature_Disease+DiseaseCatList[t.Type].CatImg:Master_Default_Pic,e=`
                        <td class="vt-number-order"></td>
                        <td>
                            <div class="d-flex">
                                <div class="avatar avatar-xs me-3">
                                    <img src="${f}"  class="rounded-0 mt-1">
                                </div>
                                <div class="d-flex flex-column justify-content-center text-center" style="width: 40px;">
                                    <h6 class="mb-0 text-sm fw-bold  text-dark">${TeethCollkv[t.Teethid].TeethName}</h6>
                                    <p class="mb-0 text-xs">${r??""}</p>
                                </div>
                            </div>
                        </td>
                        <td>${CVT_isVN?DiseaseList[t.Diseaseid].Name:DiseaseList[t.Diseaseid].NameOther||DiseaseList[t.Diseaseid].Name}</td>
                        <td>${Dendis_RenderClass(t.Classification,t.Part,t.Type,t.Diseaseid,t.Teethid)}</td>
                        <td>${Dendis_RenderTreat(t.Treat,t.Part,t.Type,t.Diseaseid,t.Teethid)}</td>
                        <td>${Dendis_RenderNote(t.Note,t.Part,t.Type,t.Diseaseid,t.Teethid)}</td>
                        <td>${Dendis_RenderButton(t.DeleteButton,t.Part,t.Type,t.Diseaseid,t.Teethid)}</td>
                    `;u=u+'<tr role="row" class="vt-number">'+e+"<\/tr>"}document.getElementById(t).innerHTML=u}Dendis_DiseaseFill(n);Dendis_DiseaseEvent()})}function Dendis_DiseaseFill(n){for(let t=0;t<n.length;t++){let i=n[t],r="classDiseaseTeeth_"+i.Part+"_"+i.Type+"_"+i.Diseaseid+"_"+i.Teethid;$("#"+r).dropdown("refresh");$("#"+r).dropdown("set selected",i.Classification)}}function Dendis_RenderClass(n,t,r,u,f){let o="classDiseaseTeeth_"+t+"_"+r+"_"+u+"_"+f,e=`<div
        data_part="${t}" data_type="${r}" data_disease="${u}" data_teethid="${f}" 
        class="ui fluid search selection dropdown form-control classDiseaseTeeth" id=${o}><input type="hidden"/><i class="dropdown icon"></i>
        <input  class="search" autocomplete="off" tabindex="0" /><div class="default text"></div><div class="menu" tabindex="-1">`;for(i=0;i<DisClassi.length;i++)e=e+`<div class="item" data-value=${DisClassi[i].ID}>${DisClassi[i].Name}</div>`;return e+`</div>`}function Dendis_RenderNote(n,t,i,r,u){return`<input data_part="${t}" data_type="${i}" data_disease="${r}" data_teethid="${u}" 
       class="form-control noteDiseaseTeeth"  type="text"  value="${n}">`}function Dendis_RenderTreat(n,t,i,r,u){return`<input data_part="${t}" data_type="${i}" data_disease="${r}" data_teethid="${u}" 
       class="form-control treatDiseaseTeeth"  type="text"  value="${n}">`}function Dendis_RenderButton(n,t,i,r,u){let f="";return n==1&&(f=`<a class="deleteDisease ms-auto ms-auto p-2 py-1" data_part="${t}" 
                data_type="${i}" data_disease="${r}" data_teethid="${u}">
                <i class="text-danger fas fa-times"  ></i>
            </a>`),f}function Dendis_DiseaseEvent(){$(".ui.dropdown.classDiseaseTeeth").dropdown({allowCategorySelection:!0,forceSelection:!1});$("#CanDisease_DetailBody .deleteDisease").unbind().click(function(){let t=$(this).attr("data_disease"),n=$(this).attr("data_teethid"),i=$(this).attr("data_type"),r=$(this).attr("data_part");for(let u=0;u<CurrentDisease.length;u++)if(CurrentDisease[u].Type==i&&CurrentDisease[u].Teethid==n&&CurrentDisease[u].Diseaseid==t&&CurrentDisease[u].Part==r){$("#teethfacetext_"+n).html("");$("#teethfacetext_"+n).css("color","black");$("#teethfacetext_"+n).css("background-color","transparent");CurrentDisease.splice(u,1);break}Dencan_Draw1Teeth(n,"","");Dendis_RenderDisease(CurrentDisease,"CanDisease_DetailBody")});$("#CanDisease_DetailBody .treatDiseaseTeeth").unbind().change(function(){let n=$(this).attr("data_disease"),t=$(this).attr("data_teethid"),i=$(this).attr("data_type"),r=$(this).attr("data_part");for(let u=0;u<CurrentDisease.length;u++)if(CurrentDisease[u].Type==i&&CurrentDisease[u].Teethid==t&&CurrentDisease[u].Diseaseid==n&&CurrentDisease[u].Part==r){CurrentDisease[u].Treat=$(this).val();break}});$("#CanDisease_DetailBody .noteDiseaseTeeth").unbind().change(function(){let n=$(this).attr("data_disease"),t=$(this).attr("data_teethid"),i=$(this).attr("data_type"),r=$(this).attr("data_part");for(let u=0;u<CurrentDisease.length;u++)if(CurrentDisease[u].Type==i&&CurrentDisease[u].Teethid==t&&CurrentDisease[u].Diseaseid==n&&CurrentDisease[u].Part==r){CurrentDisease[u].Note=$(this).val();break}});$("#CanDisease_DetailBody .classDiseaseTeeth").unbind("change").change(function(){let n=$(this).attr("data_disease"),t=$(this).attr("data_teethid"),i=$(this).attr("data_type"),r=$(this).attr("data_part");for(ii=0;ii<CurrentDisease.length;ii++)if(CurrentDisease[ii].Type==i&&CurrentDisease[ii].Teethid==t&&CurrentDisease[ii].Diseaseid==n&&CurrentDisease[ii].Part==r){let n=$(this).dropdown("get value");n!=undefined&&(CurrentDisease[ii].Classification=n,ii=CurrentDisease.length)}})}var CanTeethAreaName={l:"Trái",r:"Phải",t:"Trên",b:"Dưới",c:"Giữa",face:"",root:""};let CVT_isVN=author_get("UserLang")=="vn"||author_get("UserLang")=="";