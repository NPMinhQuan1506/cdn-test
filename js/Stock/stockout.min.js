function sdoc_dataRemove(n){$(`#trGroupNote_${n}`).remove();$(`#trGroupSup_${n}`).remove();$(`#trGroupName_${n}`).remove();$(`#rowitem_${n}`).remove();delete product_selected[n];sdoc_CountTotal()}function sdoc_dataAdd(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){let g={};g.id=t;g.sku=r;g.code=u;g.packageNumber=s;g.idProduct=t;g.SupplierID=e;g.UnitCountID=o;g.NameProduct=f;g.Number=Number(c);g.Amount=Number(p);g.Note=w;g.Unit_Standard=i;g.state=1;g.idDetail=n;g.ExpiredDay=h;g.IniAmount=a;g.DiscountAmount=Number(v);g.DiscountPer=Number(y);g.UnitPrice=Number(l);g.PriceSale=Number(b);g.CostPrice=Number(k);g.Number_Standard=Number(d);product_selected[t]!=undefined&&sdoc_dataRemove(t);product_selected[t]=g;sdoc_dataRender(t,g,"sdoc_items");sdoc_CountTotal()}function sdoc_dataRender(n,t,i){var r=document.getElementById(i);if(r!=null){let i=``,u=``;data_unitkv[t.Unit_Standard]!=undefined&&(i=data_unitkv[t.Unit_Standard].Name);t.packageNumber!=""&&(u=` 
               ( <span class="text-dark opacity-8 ps-1">${Outlang.So_lo}</span>
                <span class="px-1">${t.packageNumber}</span>
                <span class="px-1 text-dark opacity-8">${Outlang.Het_han}</span>
                <span class="pe-1">${GetDateTime_String_DMY(INTYMDToDate(t.ExpiredDay))}</span>)
             `);let f=`
            <tr id="trGroupName_${n}" data-id=${n} class="rounded-3 namemed vt-number" style="border: transparent;">
                <td colspan="100" class="my-0 py-0">
                     <div class="groupname">
                         <div class="d-flex align-items-center">
                             <a class="group  text-dark d-flex align-items-center" data-value=${n}>
                                  <i class="collapse-close opacity-3 fa fa-plus text-xs pt-1 me-2" aria-hidden="true"></i>
                                  <i class="collapse-open opacity-3 fa fa-minus text-xs pt-1 me-2" aria-hidden="true"></i>  
                                   <div class="ms-0 d-flex align-items-center">
                                      <span class="text-dark ps-0 fw-bolder pe-3 vt-number-order">.</span>
                                      <div>
                                        <span class="text-uppercase fw-bold text-dark border-dark border-3 border-bottom pb-0 fs-6">${t.code!=""?t.code:"#"}</span>
                                        <span class="text-uppercase fw-bold text-dark pb-0 fs-6 px-1">${t.sku!=""?t.sku:""}</span>
                                        <span class="text-dark fw-bold pb-0 fs-6">${t.NameProduct}</span>
                                         <span class="text-primary fw-bold pb-0 fs-6 ps-1">${i}</span>
                                        ${u}

                                      </div>
                                      
                     
                                  </div>
                              </a> 
                              <a id="trdocdelete_${n}" class="opacity-2 ms-auto remove cursor-pointer" data-id="${n}" ><i class="text-gradient text-danger me-2 fas fa-minus-circle"></i></a>
                          </div>
                      </div>
                 </td>
            </tr>
            <tr id="rowitem_${n}" class="rowitem" data-id="${n}" data-group="${n}"  role="row">
          
                <td>
                     <div class="contain">
                         ${sdoc_renderNumber(n)}
                     </div>
                </td>
                <td style="width: 120px;max-width: 120px;">
                     <div class="contain">
                         ${sdoc_renderUnit(n)}
                     </div>
                </td>
                <td style="width: 70px;max-width: 70px;">
                     <div class="contain">
                         ${sdoc_renderCoe(n)}
                     </div>
                </td>
                <td>
                     <div class="contain">
                         ${sdoc_renderUnitPrice(n)}
                     </div>
                </td>
                <td>
                   <div class="contain">
                         ${sdoc_renderprice(n)}
                     </div>
                </td>
                <td>
                    <div class="contain">
                         ${sdoc_renderDiscount(n)}
                     </div>
                </td>
                <td>
                   <div class="contain">
                         ${sdoc_renderamount(n)}
                     </div>
                </td>
                 <td>
                   <div class="contain">
                         ${sdoc_rendernorm(n,value.packageNumber)}
                     </div>
                </td>
                 

            </tr>
            <tr data-group="${n}" id="trGroupSup_${n}" >
                <td class="mt-0 py-0" colspan="100" style="border: transparent;">
                    <div class="d-flex">
                        ${sdoc_rendersup(n)}
                    </div>
                 </td>
            </tr>
            <tr data-group="${n}" id="trGroupNote_${n}" >
                <td class="mt-0 py-0" colspan="100" style="border: transparent;">
                    <div class="d-flex">
                        ${sdoc_renderNote(n)}
                    </div>
                 </td>
            </tr>
            `;r.insertAdjacentHTML("beforeend",f)}sdoc_itemFill(n,t);sdoc_itemevent(n)}function sdoc_renderNumber(n){return`
      <input id="sdi_number_${n}" data-id="${n}" class="itemval num number form-control  ps-2   form-control  d-inline-block" min="0" />
        `}function sdoc_renderCoe(n){return`
      <input id="sdi_coef_${n}" data-id="${n}" class="itemval num money form-control  ps-2   form-control  d-inline-block" min="0" disabled />
        `}function sdoc_renderUnitPrice(n){return`
      <input id="sdi_unitprice_${n}"  data-id="${n}" class="itemval num money uniprice form-control  ps-2   form-control  d-inline-block" min="0" />
        `}function sdoc_renderprice(n){return`
      <input id="sdi_price_${n}" data-id="${n}" class="itemval num money price form-control  ps-2   form-control  d-inline-block" min="0" disabled />
        `}function sdoc_renderamount(n){return`
      <input id="sdi_amount_${n}" data-id="${n}" class="itemval num money amount form-control  ps-2   form-control  d-inline-block" min="0" disabled />
        `}function sdoc_rendernorm(n,t){return`
        <div id="sdi_normarea_${n}" class="input-group normgroup flex-nowrap" >
                <input id="sdi_norm_${n}-${t}" data-id="${n}" class="itemval num money norm form-control  ps-2   form-control  d-inline-block" min="0" disabled />
                <div class="input-group-text border-0">
                    <i class="noncheck fas fa-question opacity-7"></i>
                    <i class="fail fas fa-exclamation-circle fw-bold text-danger d-none"></i>
                    <i class="succ fas fa-check-circle fw-bold text-success  d-none"></i>
                </div>
            </div>
        `}function sdoc_renderNote(n){return`
            <div class="d-flex w-100 align-items-center">
                <div class="text-sm text-dark pe-1">${Outlang.Ghi_chu} : </div>
                 <input  id="sdi_note_${n}" data-id="${n}" class="note form-control w-100 " type="text" value="" maxlength="500" />
            </div>
             `}function sdoc_renderDiscount(n){return` 
        <div class="position-relative">
            <input id="sdi_discountvalue_${n}" data-id="${n}" class="itemval money discount num form-control  ps-2 pe-5   form-control  d-inline-block" min="0" />
            <div id="sdi_discount_${n}" data-id="${n}" class="ui inline dropdown discounttype position-absolute text-sm ms-n3 text-dark top-50 start-100 translate-middle  dropdown-money">
                <input type="hidden" />
                <div class="default text"></div>
                <i class="dropdown icon"></i>
                <div class="menu" tabindex="-1">
                      <div class="item" data-value="1">%</div>
                      <div class="item" data-value="2">VND</div>
                </div>
            </div>
           `}function sdoc_renderUnit(n){return`
          <div id="sdi_unit_${n}" data-id="${n}" class="ui fluid search unit selection dropdown form-control itemval text-dark  text-sm   text-nowrap"   >
                <input type="hidden" />
                <i class="dropdown icon"></i>
                <input class="search" autocomplete="off" tabindex="0" />
                <div class="default text">eg .${Outlang.Don_vi}</div>
                <div id="sdi_cbbunit_${n}" class="menu" tabindex="-1">
                </div>
            </div>
        `}function sdoc_rendersup(n){return`
            <div class="d-flex w-100 align-items-center">
                <div class="text-sm  text-dark pe-1">${Outlang.Sys_nha_cung_cap}</div>
                <div id="sdi_sup_${n}" data-id="${n}" class="ui fluid  sup search selection dropdown form-control text-dark  text-sm   text-nowrap"   >
                    <input type="hidden" />
                    <i class="dropdown icon"></i>
                    <input class="search" autocomplete="off" tabindex="0" />
                    <div class="default text">eg .${Outlang.Sys_nha_cung_cap}</div>
                    <div id="sdi_cbbsup_${n}" class="menu" tabindex="-1">
                    </div>
                </div>
                 <a><i class="far fa-copy"></i></a>
            </div>
             `}function sdoc_itemFill(n,t){$("#sdi_number_"+n).val(t.Number);$("#sdi_unitprice_"+n).val(t.UnitPrice);$("#sdi_price_"+n).val(t.IniAmount);$("#sdi_amount_"+n).val(t.Amount);$("#sdi_note_"+n).val(t.Note);$("#sdi_coef_"+n).val(t.Number_Standard);sdoc_itemFillDis(n,t.DiscountPer,t.DiscountAmount);sdoc_itemFillSup(n,t.SupplierID);sdoc_itemFillUnit(n,t.Unit_Standard,t.UnitCountID)}function sdoc_itemFillSup(n,t){let i=","+n+",";data_supplier.sort(function(n,t){return n.TokenMaterial.includes(i.toString())?(n.Name=`<span class="pre">${n.NameString}</span>`,-1):(n.Name=n.NameString,t.TokenMaterial.includes(i.toString()))?(t.Name=`<span class="pre">${t.NameString}</span>`,1):(t.Name=t.NameString,0)});Load_Combo(data_supplier,`sdi_cbbsup_${n}`,!0);$(`#sdi_sup_${n}`).dropdown("refresh");$(`#sdi_sup_${n}`).dropdown("set selected",t)}function sdoc_itemFillUnit(n,t,i){let r=[];if(data_unitkv[t]!=undefined){let u=data_unitkv[t].Name;r.push({ID:t,Name:u});let i=data_productunit.filter(t=>t.ProductID==n);if(i!=undefined&&i.length>0)for(let n=0;n<i.length;n++)r.push({ID:i[n].UnitChange,Name:i[n].UnitChangeName})}Load_Combo(r,`sdi_cbbunit_${n}`,!0);$(`#sdi_unit_${n}`).dropdown("refresh");i!=0?$(`#sdi_unit_${n}`).dropdown("set selected",i):$(`#sdi_unit_${n}`).dropdown("set selected",t)}function sdoc_itemFillDis(n,t,i){$(`#sdi_discount_${n}`).dropdown("refresh");Number(t)!=0||Number(t)==0&&Number(i)==0?($(`#sdi_discount_${n}`).dropdown("set selected",1),$("#sdi_discountvalue_"+n).val(t)):($(`#sdi_discount_${n}`).dropdown("set selected",2),$("#sdi_discountvalue_"+n).val(i))}function sdoc_validDis(n){let i=Number($(`#sdi_discount_${n}`).dropdown("get value"))?Number($(`#sdi_discount_${n}`).dropdown("get value")):0,t=$(`#sdi_discountvalue_${n}`).val(),r=product_selected[n].IniAmount;return!isNaN(t)&&Number(t)>=0?($(`#sdi_discountvalue_${n}`).removeClass("error"),i==1?t>=0&&t<=100?($(`#sdi_discountvalue_${n}`).removeClass("error"),1):($(`#sdi_discountvalue_${n}`).addClass("error"),0):t<=r?($(`#sdi_discountvalue_${n}`).removeClass("error"),1):($(`#sdi_discountvalue_${n}`).addClass("error"),0)):($(`#sdi_discountvalue_${n}`).addClass("error"),0)}function sdoc_validNumber(n,t,i,r){let u=0,f=Number(n.attr("data-id"));isNaN(t)?u=1:(r==1&&Number(t)<=0&&(u=1),r==0&&Number(t)<0&&(u=1));u==0?(product_selected[f][i]=Number(t),n.removeClass("error")):(product_selected[f][i]=0,n.addClass("error"))}function sdoc_ItemcountPrice(n){sdoc_flag=0;let i=product_selected[n].Number,r=product_selected[n].UnitPrice,t=i*r;product_selected[n].IniAmount=t;$(`#sdi_price_${n}`).val(t);let u=sdoc_validDis(n);if(u==0)product_selected[n].DiscountAmount=0,product_selected[n].DiscountPer=0,product_selected[n].Amount=product_selected[n].IniAmount,$(`#sdi_amount_${n}`).val(product_selected[n].Amount);else{let r=Number($(`#sdi_discount_${n}`).dropdown("get value"))?Number($(`#sdi_discount_${n}`).dropdown("get value")):0,i=$(`#sdi_discountvalue_${n}`).val();r==1?(product_selected[n].DiscountPer=i,product_selected[n].DiscountAmount=t/100*i):(product_selected[n].DiscountPer=0,product_selected[n].DiscountAmount=i);product_selected[n].Amount=product_selected[n].IniAmount-product_selected[n].DiscountAmount;$(`#sdi_amount_${n}`).val(product_selected[n].Amount)}sdoc_flag=1;sdoc_CountTotal()}function sdoc_ItemCountUnitPrice(n){sdoc_flag=0;let u=product_selected[n].idProduct,f=product_selected[n].Unit_Standard,e=product_selected[n].UnitCountID,t=1,i=data_productunitkv[u+"-"+f+"-"+e];i!=undefined&&(t=i.Number);let r=product_selected[n].CostPrice;product_selected[n].UnitPrice=r*t;$(`#sdi_coef_${n}`).val(t);product_selected[n].Number_Standard=t;$(`#sdi_unitprice_${n}`).val(r*t);sdoc_flag=1}function sdoc_itemevent(n){$("#sdoc_items a.group").unbind("click").click(function(){let n=$(this).attr("data-value");$(this).hasClass("openned")?($(this).removeClass("openned"),$('#sdoc_items tr[data-group="'+n+'"]').removeClass("d-none")):($(this).addClass("openned"),$('#sdoc_items tr[data-group="'+n+'"]').addClass("d-none"))});$(`#sdi_number_${n}`).unbind("change").change(function(){if(sdoc_flag==1){let n=Number($(this).attr("data-id"));sdoc_validNumber($(this),$(this).val(),"Number",1);sdoc_ItemcountPrice(n)}});$(`#sdi_unitprice_${n}`).unbind("change").change(function(){if(sdoc_flag==1){let n=Number($(this).attr("data-id"));sdoc_validNumber($(this),$(this).val(),"UnitPrice",0);sdoc_ItemcountPrice(n)}});$(`#sdi_price_${n}`).unbind("change").change(function(){if(sdoc_flag==1){let n=Number($(this).attr("data-id"));sdoc_validNumber($(this),$(this).val(),"IniAmount",0);sdoc_ItemcountPrice(n)}});$(`#sdi_amount_${n}`).unbind("change").change(function(){if(sdoc_flag==1){let n=Number($(this).attr("data-id"));sdoc_validNumber($(this),$(this).val(),"Amount",0);sdoc_ItemcountPrice(n)}});$(`#sdi_note_${n}`).unbind("change").change(function(){let n=$(this).attr("data-id"),t=$(this).val();product_selected[n].Note=t});$(`#sdi_unit_${n}`).unbind("change").change(function(){if(sdoc_flag==1){let n=Number($(this).attr("data-id")),t=Number($(this).dropdown("get value"))?Number($(this).dropdown("get value")):0;sdoc_validNumber($(this),t,"UnitCountID",1);sdoc_ItemCountUnitPrice(n);sdoc_ItemcountPrice(n)}});$(`#sdi_sup_${n}`).unbind("change").change(function(){if(sdoc_flag==1){let n=Number($(this).dropdown("get value"))?Number($(this).dropdown("get value")):0;sdoc_suprequire==1?sdoc_validNumber($(this),n,"SupplierID",1):sdoc_validNumber($(this),n,"SupplierID",0)}});$(`#sdi_discount_${n}`).unbind("change").change(function(){if(sdoc_flag==1){let n=$(this).attr("data-id");sdoc_ItemcountPrice(n)}});$(`#sdi_discountvalue_${n}`).unbind("change").change(function(){if(sdoc_flag==1){let n=$(this).attr("data-id");sdoc_ItemcountPrice(n)}});$(`#trdocdelete_${n}`).unbind("click").click(function(){let n=$(this).attr("data-id");sdoc_dataRemove(n)});$("#sdoc_items .ui.dropdown").dropdown();$("#sdoc_items .money").divide()}