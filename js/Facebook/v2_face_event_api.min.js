function Face_API_Get_Conversation_More(){numload_mess_current=numload_mess_current+numload_mess_step;Face_API_Get_Conversation(numload_mess_current,1)}function Face_API_Get_Conversation(n,t){xhrRequestFacebook&&xhrRequestFacebook.readyState!=4&&xhrRequestFacebook.abort();Face_SH_Begin_LoadDetail();face_data_chatting=[];face_data_chatting_having_phone=[];let r=facebook_link_detailconversation.replace("{pageid}",face_value_current_page).replace("{version}",facebook_version);r=r.replace("{number}",n);r=r.replace("{userid}",face_value_current_client);r=r+"&access_token="+Face_Get_Token_Access_From_PageID(face_value_current_page);xhrRequestFacebook=$.ajax({url:r,dataType:"json",type:"GET",data:JSON.stringify({}),contentType:"application/json; charset=utf-8","async":!0,error:function(n){face_is_send_mess_from_comment!=0?(Face_SH_Complete_LoadDetail(),$("#attachFileImg").hide()):(Face_Error_API(1,n.responseJSON!=undefined?n.responseJSON.error.message:""),xhrRequestFacebook&&xhrRequestFacebook.readyState!=4&&xhrRequestFacebook.abort(),Face_SH_Click_Error())},success:function(n){if(n!=undefined&&n.data!=undefined&&n.data.length==1){let r=n.data[0].messages;if(facebook_link_inbox_mail=n.data[0].link,r!=undefined&&r.length!=0){let n=r.data;for(i=0;i<n.length;i++){let t={};t.created_time=n[i].created_time;t.from=n[i].from;t.to=n[i].to.data[0];t.message=n[i].message;t.attachments=n[i].hasOwnProperty("attachments")?n[i].attachments.data:[];t.sticker=n[i].hasOwnProperty("sticker")?n[i].sticker:"";let r=Face_Checking_String_Is_Phone(n[i].message);if(r!=""){let t={};t.phone=r;t.created_time=n[i].created_time;face_data_chatting_having_phone.push(t)}face_data_chatting.push(t)}}Face_Render_Message_Having_Phone(face_data_chatting_having_phone,"facebook_getphone");Face_Event_Click_Create_Ticket();Face_Render_API_Conversation(face_data_chatting,"MessengerArea_Messenger",t);Face_SH_Complete_LoadDetail()}else face_is_send_mess_from_comment!=0?Face_SH_Complete_LoadDetail():(Face_Error_API(1,XMLHttpRequest.responseJSON!=undefined?XMLHttpRequest.responseJSON.error.message:""),xhrRequestFacebook&&xhrRequestFacebook.readyState!=4&&xhrRequestFacebook.abort(),Face_SH_Click_Error());face_is_send_mess_from_comment=0;$("#MessengerArea_Reply_Comment").hide()}})}function Face_Error_API(n){switch(Number(n)){}}function Face_SH_Complete_LoadDetail_Comment(){$("#MessengerArea_Messenger_loaderList").hide()}function Face_SH_Complete_LoadDetail(){$("#loadmoreDetail").show();$("#MessengerArea_Messenger_loaderList").hide()}function Face_SH_Begin_LoadDetail(){$("#loadmoreDetail").hide();$("#MessengerArea_Messenger_loaderList").show();$("#ParentMessengerArea_Attachment").hide()}function Face_Checking_String_Is_Phone(n){let t="";return/\d{3}/.test(n)&&(n=n.split(" ").join(""),n=n.split("+").join(""),n=n.split(")").join(""),n=n.split("(").join(""),n=n.split(".").join(""),n=n.split("-").join(""),n=n.replace(/[^0-9]/g,""),!isNaN(n)&&n.length>8&&n.length<13&&(t=n)),t}function Face_Render_API_Conversation(n,t,i){var u=document.getElementById(t),r;if(u!=null){let i="";if(n&&n.length>0){let t=new Date;for(r=n.length-1;r>=0;r--){let f="",u=n[r];f=Face_Render_API_Conversation_Each(u);let e=Face_Render_API_Conversation_Date(u.created_time,t);t=new Date(u.created_time);i=i+e+f}}document.getElementById(t).innerHTML=i}Face_ScrollContentTo_First_Last(i);Face_Image_Chating_Click();Face_Image_Chating_Load();Face_Event_Show_Title()}function Face_Event_Show_Title(){$(".message_me,.message_client,.sticker_client,.sticker_me,.image_me,.video_me,.file_me,.image_client,.video_client,.file_client").qtip({content:{text:function(){return $(this).attr("oldtitle")}}})}function Face_Render_API_Conversation_Each(n){let i=n.sticker,r=n.message,f=n.attachments,e=ConvertDateTimeUTC_Time(n.created_time),t=ConvertDateTimeUTC_Time_OnlyHour(n.created_time),o=ConvertDateTimeToTimeSpan(n.created_time),u=face_value_current_page==n.from.id?"me":"client";return u=="me"?'<div id="'+o+'" class="messengerDetail_me" data_times="'+n.created_time+'">'+(r==""?"":'<span class="message_me" title="'+t+'">'+r+"<\/span>")+(i==""?"":'<img class="sticker_me" title="'+t+'" src="'+i+'">')+Face_Render_API_Conversation_Attachment(f,u,e,t)+"<\/div>":'<div id="'+o+'" class="messengerDetail_client" data_times="'+n.created_time+'">'+(r==""?"":'<span class="message_client" title="'+t+'">'+r+"<\/span>")+(i==""?"":'<img class="sticker_client" title="'+t+'" src="'+i+'">')+Face_Render_API_Conversation_Attachment(f,u,e,t)+"<\/div>"}function Face_Render_API_Time_Send(n,t,i){let r=ConvertDateTimeUTC_Time_OnlyHour(t);return n=="me"?'<div class="messengerDetail_me"><span class="message_me message_me_time_send" data_time="'+t+'" title="Time" id="send_'+i+'">'+r+"<\/span><\/div>":'<div class="messengerDetail_client"><span class="message_client message_client_time_send" data_time="'+t+'" title="Time" id="send_'+i+'">'+r+"<\/span><\/div>"}function Face_Render_API_Conversation_Date(n,t){var i=new Date(n),r;return i.getDate()==t.getDate()&&i.getYear()==t.getYear()&&i.getMonth()==t.getMonth()?(r=Math.abs(i-t),r>9e5?'<div class="linedate">'+Face_Convert_Date_To_DOW_HM(i)+"<\/div>":""):'<div class="linedate">'+Face_Convert_Date_To_DOW_DMY(i)+"<\/div>"}function Face_Render_API_Conversation_Attachment(n,t,r,u){if(n==[]||n.length==0)return"";let s="",h="",e="",o=200,f=0;for(i=0;i<n.length;i++)if(n[i]!=null){let t=n[i].mime_type;t.includes("image")&&(f=f+1)}for(o=f<2?200:f>=2&&f<5?100:f>=5&&f<10?70:50,i=0;i<n.length;i++)if(n[i]!=null){let f=n[i].mime_type,c="",v="/assests/img/Face/loading_image_face.gif";n[i].hasOwnProperty("file_url")&&(c=n[i].file_url);f.includes("image")&&(c=n[i].image_data.url);f.includes("video")&&(c=n[i].video_data.url,preview_url=n[i].video_data.preview_url);let y=decodeURI(n[i].name),l="",a="";t=="me"?(e="groupAttachment_me",f.includes("image")?a='<img class="image_me" style="width:'+o+"px;height:"+o+'px" data_render=0 data_link="'+c+'" oldtitle="'+u+'" src="'+v+'">':l=f.includes("video")?'<video class="video_me" oldtitle="'+u+'" controls><source  data_render=0 class="video_me_source" type="'+f+'" data_link="'+c+'"><\/video>':f.includes("audio")?'<audio class="audio_me" oldtitle="'+u+'" controls><source type="'+f+'" src="'+c+'"><\/audio>':'<a class="file_me" oldtitle="'+r+'" href="'+c+'"><i class="arrow down icon" style="display: contents;"><\/i>&nbsp;&nbsp;'+y+"<\/a>"):(e="groupAttachment_client",f.includes("image")?a='<img class="image_client" style="width:'+o+"px;height:"+o+'px" data_render=0 data_link="'+c+'" oldtitle="'+u+'" src="'+v+'">':l=f.includes("video")?'<video  class="video_client" oldtitle="'+u+'" controls><source data_render=0 class="video_client_source" type="'+f+'" data_link="'+c+'"><\/video>':f.includes("audio")?'<audio class="audio_client" oldtitle="'+u+'" controls><source type="'+f+'" src="'+c+'"><\/audio>':'<a class="file_client" oldtitle="'+r+'" href="'+c+'"><i class="arrow down icon" style="display: contents;"><\/i>&nbsp;&nbsp;'+y+"<\/a>");s=s+l;h=h+a}return'<div class=" groupAttachment_top '+e+'"><div class="'+e+'">'+h+'<\/div> <\/div><div class="'+e+'">'+s+"<\/div>"}function Face_ScrollContentTo_First_Last(n){if(n!=undefined&&n==1){var t=document.getElementById("MessengerArea_Messenger");t.scrollTop=0}else setTimeout(()=>{var n=document.getElementById("MessengerArea_Messenger");n.scrollTop=n.scrollHeight})}function Face_Image_Chating_Click(){$(".image_me").unbind().click(function(){window.open(this.src);return});$(".image_client").unbind().click(function(){window.open(this.src);return})}function Face_Image_Chating_Load(){let n=document.getElementsByClassName("image_client");if(n!=undefined)for(ii_=0;ii_<n.length;ii_++)Number(n[ii_].attributes.data_render.value)==0&&(n[ii_].src=n[ii_].attributes.data_link.value,n[ii_].attributes.data_render.value=1);if(n=document.getElementsByClassName("image_me"),n!=undefined)for(ii_=0;ii_<n.length;ii_++)Number(n[ii_].attributes.data_render.value)==0&&(n[ii_].src=n[ii_].attributes.data_link.value,n[ii_].attributes.data_render.value=1);if(n=document.getElementsByClassName("video_client_source"),n!=undefined)for(ii_=0;ii_<n.length;ii_++)Number(n[ii_].attributes.data_render.value)==0&&(n[ii_].src=n[ii_].attributes.data_link.value,n[ii_].attributes.data_render.value=1);if(n=document.getElementsByClassName("video_me_source"),n!=undefined)for(ii_=0;ii_<n.length;ii_++)Number(n[ii_].attributes.data_render.value)==0&&(n[ii_].src=n[ii_].attributes.data_link.value,n[ii_].attributes.data_render.value=1)}function Face_API_Send_MESSAGE(){face_value_current_mess_post=="COM"&&Face_API_Send_COMMENT_Text();face_value_current_mess_post=="MESS"&&(Face_API_Send_MESSAGE_Text(),Face_API_Send_MESSAGE_Attachment())}function Face_API_Send_MESSAGE_Text(){let n=$("#txtContentMessage_Chatting").val().trim();if($("#txtContentMessage_Chatting").val(""),n!=""&&face_value_current_client!=""){let i={};i=face_is_send_mess_from_comment!=1?{id:face_value_current_client}:{comment_id:face_value_current_comment};let t=(new Date).getTime();Face_Send_Temporary_Text(n,t,"MessengerArea_Messenger");$.ajax({url:facebook_link_send_message.replace("{version}",facebook_version),dataType:"json",type:"POST",contentType:"application/json",data:JSON.stringify({messaging_type:"RESPONSE",recipient:JSON.stringify(i),message:JSON.stringify({text:n}),access_token:Face_Get_Token_Access_From_PageID(face_value_current_page)}),contentType:"application/json; charset=utf-8","async":!0,error:function(i){i.responseJSON.error.code==10?(Face_Error_API(10,i.responseJSON!=undefined?i.responseJSON.error.message:""),Face_API_Send_MESSAGE_Text_With_TagSend(n,t)):(Face_Error_API(1,i.responseJSON!=undefined?i.responseJSON.error.message:""),$("#"+Number(t)).length&&($("#spantext_temp_"+Number(t)).hasClass("temporary_error")||($("#spantext_temp_"+Number(t)).addClass("temporary_error"),$("#spanimg_temp_"+Number(t)).attr("src","/assests/img/Face/problem.png"))))},success:function(n){if(n!=null&&n!=undefined&&n.message_id!=undefined&&n.recipient_id!=undefined&&n.message_id!=null&&n.recipient_id!=null)if(face_is_send_mess_from_comment!=1){let i=n.message_id;Face_API_Get_Message_Detail("me",i,t)}else Face_Trigger_Click(face_value_current_page+"-"+n.recipient_id)},complete:function(){face_is_send_mess_from_comment=0}})}}function Face_API_Send_MESSAGE_Text_With_TagSend(n,t){$.ajax({url:facebook_link_send_message.replace("{version}",facebook_version),dataType:"json",type:"POST",contentType:"application/json",data:JSON.stringify({messaging_type:"MESSAGE_TAG",recipient:JSON.stringify({id:face_value_current_client}),message:JSON.stringify({text:n}),tag:face_tag_send,access_token:Face_Get_Token_Access_From_PageID(face_value_current_page)}),contentType:"application/json; charset=utf-8","async":!0,error:function(){$("#"+Number(t)).length&&($("#spantext_temp_"+Number(t)).hasClass("temporary_error")||($("#spantext_temp_"+Number(t)).addClass("temporary_error"),$("#spanimg_temp_"+Number(t)).attr("src","/assests/img/Face/problem.png")))},success:function(n){if(n!=null&&n!=undefined&&n.message_id!=undefined&&n.recipient_id!=undefined&&n.message_id!=null&&n.recipient_id!=null){let i=n.message_id;Face_API_Get_Message_Detail("me",i,t)}}})}function Face_Send_Temporary_Text(n,t,r){var u=document.getElementById(r).children,f=document.getElementById(r),e;if(u!=undefined){let r="";if(n!=undefined&&n){let i="";i='<div id="'+t+'"  class="messengerDetail_me">'+(n==""?"":'<span id="spantext_temp_'+t+'" class="message_me message_me_temp" ><img title="Something wrongs" id="spanimg_temp_'+t+'" class="waitingfacebook_exe" src="/assests/img/Face/waiting_exe.gif" alt="label-image" />'+n+"<\/span>")+"<\/div>";r=i}if(r!=""){let o=t!=""?Number(t):0,n=0;for(i=u.length-1;i>=0;i--){let t=u[i].id;o>t&&(n=i,i=0)}e=createElementFromHTML(r);n==u.length-1?f.appendChild(e):f.insertBefore(e,f[n-1])}}Face_ScrollContentTo_First_Last()}function Face_Time_Checking_Distince(n,t){try{let u="";u=t=="me"?"message_me_time_send":"message_client_time_send";let r=document.getElementsByClassName(u);if(r!=undefined&&r.length!=0){let t=r[r.length-1].attributes.data_time.value;var i=Math.abs(new Date(n)-new Date(t));i<4e5&&$("#"+r[r.length-1].id).remove()}}catch(r){}}function Face_API_Get_Message_Detail(n,t,i){$.ajax({url:facebook_link_message.replace("{message_id}",t).replace("{version}",facebook_version)+"&access_token="+Face_Get_Token_Access_From_PageID(face_value_current_page),dataType:"json",type:"GET",data:JSON.stringify({}),contentType:"application/json; charset=utf-8","async":!0,error:function(){},success:function(n){let t={},r="text",u="";if(t.created_time=n.created_time,t.from=n.from,t.to=n.to.data[0],t.message=n.message,n.hasOwnProperty("attachments")){if(t.attachments=n.attachments.data,n.attachments.data[0].hasOwnProperty("mime_type")){let t=n.attachments.data[0].mime_type;t.includes("image")?(r="image",u=n.attachments.data[0].image_data.url):(t.includes("excel")||t.includes("pdf")||t.includes("word"))&&(r="file",u="")}}else t.attachments=[];t.sticker=n.hasOwnProperty("sticker")?n.sticker:"";face_data_chatting.push(t);Face_Update_Chatting_On_Design(r,t,n.created_time,i);Face_Send_Message_Sucessful(face_value_current_conver_id,n.from,r,n.message,u)},complete:function(){$("#"+Number(i)).length&&$("#"+Number(i)).remove();Face_ScrollContentTo_First_Last();Face_Image_Chating_Click();Face_Event_Show_Title()}})}function Face_Update_Chatting_On_Design(n,t,r){Face_Time_Checking_Distince(r,n);var e=document.getElementById("MessengerArea_Messenger"),u=document.getElementById("MessengerArea_Messenger").children,o=createElementFromHTML(Face_Render_API_Conversation_Each(t));let f=0;for(i=u.length-1;i>=0;i--){let n=u[i].attributes.data_times!=undefined?u[i].attributes.data_times.value:"";n<=r&&n!=""&&(f=i,i=0)}f==u.length-1?e.appendChild(o):e.insertBefore(o,u[f+1]);Face_Image_Chating_Load()}function Face_Update_Conversation_Having_Phone(n,t){let r=Face_Checking_String_Is_Phone(n);if(r!=""){let n={};n.phone=r;n.created_time=t;face_data_chatting_having_phone.push(n);let f=ConvertDateTimeUTC_Time_DOWFULLDAY(n.created_time),e=Face_Render_Message_Having_Phone_Each(f,r);var i=document.getElementById("facebook_getphone"),u=createElementFromHTML(e);i.children.length!=0?i.insertBefore(u,i[0]):i.appendChild(u);Face_Event_Click_Create_Ticket()}}var facebook_link_detailconversation_byuser="https://graph.facebook.com/{version}/{pageid}/conversations?fields=id&user_id={userid}",facebook_link_detailconversation="https://graph.facebook.com/{version}/{pageid}/conversations?fields=link,messages.limit({number}){created_time,to,from,message,id,attachments,sticker}&user_id={userid}",facebook_link_message="https://graph.facebook.com/{version}/{message_id}?fields=message,created_time,to,attachments,sticker,from,id",facebook_link_comment_detail="https://graph.facebook.com/{version}/{comment_id}?fields=message,comments{created_time,message,attachment,from,is_hidden,like_count,permalink_url},attachment,created_time,permalink_url,from,is_hidden,like_count",facebook_link_post="https://graph.facebook.com/{version}/{post_id}?fields=full_picture,message,created_time,from,permalink_url",facebook_link_send_message="https://graph.facebook.com/{version}/me/messages",facebook_link_get_info_client="https://graph.facebook.com/{version}/{client}",facebook_link_upload_attach="https://graph.facebook.com/{version}/me/message_attachments",facebook_link_executecomment="https://graph.facebook.com/{version}/{comment_id}",facebook_link_send_comment="https://graph.facebook.com/{version}/{comment_id}/comments",facebook_link_blocked="https://graph.facebook.com/{version}/{page_id}/blocked",facebook_link_client_info="https://graph.facebook.com/{version}/{client_id}",face_data_chatting=[],face_data_comment=[],face_data_post=[],face_data_chatting_having_phone=[];