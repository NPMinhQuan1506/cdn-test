function Face_AttachFile_ToSend(n){n!=null&&n!=undefined&&n.files!=null&&n.files!=undefined&&n.files.length!=0&&Face_AttachFile_ShowPreview(n)}function Face_AttachFile_ShowPreview(n){if(n!=undefined&&n.files.length!=0)for(let t=0;t<n.files.length;t++)if(n.files[t].size>5e7)notiWarning("File size is too large");else if(Face_Attach_Checking_File_Type_Allow(n.files[t].type)){let i=n.files[t],r=i.slice(0,i.size,"image/png"),u=new File([r],xoa_dau(i.name.replaceAll(" ","")),{type:i.type});Face_Attach_LoadFinish(u)}else notiWarning("Wrong format")}function Face_Attach_Checking_File_Type_Allow(n){console.log(n);n=n.toLowerCase();let t=!1;for(let i=0;i<face_attach_file_allow.length;i++)face_attach_file_allow[i]==n&&(i=face_attach_file_allow.length,t=!0);return t}function Face_ShowHideAttachment(){face_value_current_attach.length==0?($("#ParentMessengerArea_Attachment").hide(),$("#MessengerArea_Attachment").empty(),$("#MessengerArea_Messenger").css({height:"calc(100vh - 220px)"})):($("#ParentMessengerArea_Attachment").show(),$("#MessengerArea_Messenger").css({height:"calc(100vh - 405px)"}))}function Face_Attach_LoadFinish(n){var t=new FileReader;t.onload=function(){var u,i;let r=(new Date).getTime();$("#"+r).length&&(r=r+1);u=document.getElementById("MessengerArea_Attachment");u.appendChild(Face_Attach_Generate_Preview(n.type,t.result,n.name,r));i={};i.id=r;i.type=n.type;i.filetype=n.type.includes("image")?"image":n.type.includes("video")?"video":"file";i.value=t.result;i.name=n.name;i.attachmentid=0;i.file=n;face_value_current_attach.push(i);Face_ShowHideAttachment();Face_Event_Delete_Attachment()};t.readAsDataURL(n);t.onerror=function(){}}function Face_Attach_Generate_Preview(n,t,i,r){var u=document.createElement("div");return u.innerHTML=n.includes("image")?'<div class="divImageAttachment" id="div_'+r+'"><i id="dele_'+r+'" class="iconDeleteAttachment vtt-icon vttech-icon-delete"><\/i><img class="imgAttachment" src="'+t+'"><\/div>':'<div class="divFileAttachment" id="div_'+r+'"><i id="dele_'+r+'" class="iconDeleteAttachment vtt-icon vttech-icon-delete"><\/i>'+i+"<\/div><\/div>",u.firstChild}function Face_Event_Delete_Attachment(){$(".iconDeleteAttachment").click(function(){let n=this.id.replace("dele_","");Face_Attach_Remove_From_Array(n);Face_ShowHideAttachment()})}function Face_Attach_Remove_From_Array(n){for(var t=0;t<face_value_current_attach.length;t++)face_value_current_attach[t].id==n&&(face_value_current_attach.splice(t,1),$("#div_"+n).remove())}function Face_API_Send_MESSAGE_Attachment(){if(face_value_current_attach!=undefined&&face_value_current_attach.length!=0)for(ii=0;ii<face_value_current_attach.length;ii++){let n=face_value_current_attach[ii].id,i=face_value_current_attach[ii].filetype;Face_Send_Temporary_Attach(n,"MessengerArea_Messenger");let t=face_link_upload_file.replace("{type}",i);t=t.replace("{timespan}",n);AjaxUpload_MultiExe(t,face_value_current_attach[ii].file,face_value_current_attach[ii].file.name,success=function(t){if(t!="0"){let n=t.split("||"),i=n[0],r=n[1],u=n[2];Face_API_Send_MESSAGE_Attachment_Execute(r,i,u)}else $("#"+Number(n)).length&&$("#"+Number(n)).remove()},error,before)}face_value_current_attach=[];Face_ShowHideAttachment()}function Face_API_Attachment_To_Folder(n,t,i){try{let u=face_link_upload_file.replace("{type}",t);u=u.replace("{timespan}",n);var r=new FormData;r.append(n,i);$.ajax({url:u,data:r,processData:!1,contentType:!1,type:"POST",error:function(){console.log("Error")},success:function(t){if(t!="0"){let n=t.split("||"),i=n[0],r=n[1],u=n[2];Face_API_Send_MESSAGE_Attachment_Execute(r,i,u)}else $("#"+Number(n)).length&&$("#"+Number(n)).remove()},beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+localStorage.getItem("WebToken"))}})}catch(u){}}function Face_API_Send_MESSAGE_Attachment_Execute(n,t,i){let r=face_Link_HTTP_File+t;$.ajax({url:facebook_link_send_message.replace("{version}",facebook_version),dataType:"json",type:"POST",contentType:"application/json",data:JSON.stringify({recipient:JSON.stringify({id:face_value_current_client}),message:JSON.stringify({attachment:{type:i,payload:{url:r,is_reusable:!0}}}),access_token:Face_Get_Token_Access_From_PageID(face_value_current_page)}),contentType:"application/json; charset=utf-8","async":!0,error:function(n){n.responseJSON.error.code==10?Face_Error_API(10,n.responseJSON!=undefined?n.responseJSON.error.message:""):Face_Error_API(1,n.responseJSON!=undefined?n.responseJSON.error.message:"")},success:function(t){if(t!=null&&t!=undefined&&t.message_id!=undefined&&t.recipient_id!=undefined&&t.message_id!=null&&t.recipient_id!=null){let i=t.message_id;Face_API_Get_Message_Detail("me",i,n)}},complete:function(){$("#"+Number(n)).length&&$("#"+Number(n)).remove();Face_Attachment_Delete_After_Send(t);Face_Image_Chating_Click()}})}function Face_Attachment_Delete_After_Send(n){let t=new FormData;t.append(n,n);$.ajax({url:face_link_delete_file,data:t,processData:!1,contentType:!1,type:"POST",error:function(){console.log("Error")},success:function(){console.log("Success")},beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+localStorage.getItem("WebToken"))}})}function Face_Send_Temporary_Attach(n,t){var r=document.getElementById(t).children,u=document.getElementById(t),i;if(r!=undefined){let t="",r='<div id="'+n+'"  class="messengerDetail_me"><img id="att_'+n+'" class="message_me attachment_me_temp" src="/assests/img/Face/loading_avatar.gif" height="200" width="200"><\/div>';t=r;t!=""&&(i=createElementFromHTML(t),u.appendChild(i))}Face_ScrollContentTo_First_Last()}var face_link_upload_file="/Api/Upload/UploadFace?Method=Upload&Type={type}&TimeSpan={timespan}",face_link_delete_file="/Api/Upload/UploadFace?Method=Delete";