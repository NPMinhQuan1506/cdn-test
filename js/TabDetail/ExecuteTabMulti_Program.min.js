function onTab_FreeSevice(){let n=Number($("#ReasonFreeID").dropdown("get value"))?Number($("#ReasonFreeID").dropdown("get value")):0;n!=0?($("#ReasonDiscountID").dropdown("clear"),$("#txtDiscountAmountPer").val(0),$("#discountTabCombo").dropdown("clear"),$("#DiscountVoucherID").dropdown("clear"),$("#DiscountCustomerGroupID").dropdown("clear"),$("#TabInsuranceID").dropdown("clear"),$("#Tabins_Term").dropdown("clear"),$("#Tabins_Frequency").dropdown("clear"),$("#Tabins_Sup").dropdown("clear"),$("#discountTabCombo").addClass("disabled"),$("#DiscountVoucherID").addClass("disabled"),$("#DiscountCustomerGroupID").addClass("disabled"),$("#ReasonDiscountID").addClass("disabled"),$("#txtDiscountAmountPer").prop("disabled",!0),$("#DiscountAmountPer").addClass("disabled"),$("#TabInsuranceID").addClass("disabled")):($("#ReasonDiscountID").removeClass("disabled"),$("#discountTabCombo").removeClass("disabled"),$("#DiscountVoucherID").removeClass("disabled"),$("#DiscountCustomerGroupID").removeClass("disabled"),$("#txtDiscountAmountPer").prop("disabled",!1),$("#DiscountAmountPer").removeClass("disabled"),$("#TabInsuranceID").removeClass("disabled"));Tab_Count_Price_For_All()}function Tab_Detail_FreeSevice_Show(){$("#ReasonFreeID").dropdown("clear")}function onTab_UsingPoint(){Tab_Count_Price_For_All()}function onTab_Insurance(){try{$("#Tabinsur_Per").val(0);$("#Tabinsur_Amount").val(0);let n=$("#TabInsuranceID").dropdown("get value")?$("#TabInsuranceID").dropdown("get value"):"";n!=0?($("#Tabinsur_Per").removeClass("disabled"),$("#Tabinsur_Amount").removeClass("disabled")):($("#Tabinsur_Per").addClass("disabled"),$("#Tabinsur_Amount").addClass("disabled"));Tab_Count_Price_For_All()}catch(n){}}function onTab_InsuranceAmount(){tab_changing_flag==1&&Tab_Count_Price_For_All()}function onTab_InsurancePer(){tab_changing_flag==1&&(tab_changing_flag=0,$("#Tabinsur_Amount").val(0),tab_changing_flag=1,Tab_Count_Price_For_All())}function Tab_Detail_Self_Discount_Validate_Value(n,t,i,r,u,f){$("#txtDiscountAmountPer").css("background-color","white");let e,o={};o.result_percent=0;o.result_value=0;let s=0;return isNaN(t)&&t!=""?s=1:(e=Number(t?t:0),n==1&&e>100&&(s=1),n==1&&e>f&&r==1&&(s=1),n==2&&e>u&&r==1&&(s=1)),s==0?n==1?(o.result_percent=e,o.result_value=Number(i/100*e)):(o.result_percent=0,o.result_value=e):($("#txtDiscountAmountPer").css("background-color","rgb(255 216 216)"),r==1?$("#textShowMessage").html(Outlang.Vuot_khoang_giam_duoc_cho_phep):$("#textShowMessage").html(Outlang.Sai_dinh_dang)),o}function TM_checkdiscount(n,t,i,r){if(Number(n)==0)$("#"+r).hide();else{$("#"+r).show();let n="<span>(&nbsp"+i+"%&nbsp|&nbsp"+formatNumber(t)+"&nbsp)<\/span>";$("#"+r).html(n)}}function OnInsSup_Change(){try{let t=$("#Tabins_Sup").dropdown("get value")?$("#Tabins_Sup").dropdown("get value"):"",n=data_InstallTerm.filter(n=>n.SupCode==t);n!=undefined&&n.length!=0?(Load_Combo(n,"ccbTabins_Term",!1),$("#Tabins_Term").dropdown("refresh"),$("#Tabins_Term").dropdown("set selected",n[0].ID)):($("#Tabins_Term").dropdown("clear"),$("#Tabins_Frequency").dropdown("clear"));Tab_Count_Price_For_All()}catch(n){}}function OnInsSup_Term(){let t=$("#Tabins_Term").dropdown("get value")?$("#Tabins_Term").dropdown("get value"):"",i=$("#Tabins_Sup").dropdown("get value")?$("#Tabins_Sup").dropdown("get value"):"",n=data_InstallTerm.filter(n=>n.SupCode==i&&n.ID==t).map(n=>({ID:n.Frequency,Name:`${n.Frequency} ${Outlang.Sys_thang} / 1 ${Outlang.Lan}`})).reduce((n,t)=>(n.some(n=>n.ID===t.ID)||n.push(t),n),[]);n!=undefined&&n.length!=0&&(Load_Combo(n,"ccbTabins_Frequency",!0),$("#Tabins_Frequency").dropdown("refresh"),$("#Tabins_Frequency").dropdown("set selected",n[0].ID));tab_changing_flag==1&&Tab_Count_Price_For_All()}function OnInsSup_Frequency(){tab_changing_flag==1&&Tab_Count_Price_For_All()}function Tab_Detail_Installment_Show(n,t){let r=!1,i=n.filter(n=>Number(n.ID)==Number(t));i!=undefined&&i.length==1&&Number(i[0].IsInstallment)==1&&(r=!0);r||($("#Tabins_Sup").dropdown("refresh"),$("#Tabins_Sup").dropdown("clear"))}function Tab_Detail_HelpingChoosing_Program(n,t){if(n!=0&&$("#discountTabCombo").length&&(t==0?(sys_AutoselectPro==1&&($("#discountTabCombo").dropdown("refresh"),$("#discountTabCombo").dropdown("set selected",n)),$("#tab_discount").addClass("tab_noti")):$("#tab_discount").length!=0&&$("#tab_discount").removeClass("tab_noti")),t!=0&&$("#DiscountCustomerMemberID").length&&(n==0?($("#DiscountCustomerMemberID").dropdown("refresh"),$("#DiscountCustomerMemberID").dropdown("set selected",t),$("#tab_customer_group").addClass("tab_noti")):$("#tab_customer_group").length!=0&&$("#tab_customer_group").removeClass("tab_noti")),n!=0&&t!=0&&$("#DiscountCustomerMemberID").length&&$("#discountTabCombo").length){if($("#helpchosing_program").length){$("#helpchosing_program").show();$("#IsCheckChossing_CTKM")[0].dataset.id=n;$("#IsCheckChossing_CUSMEM")[0].dataset.id=t;help_program_changing_flag=0;let i=data_discount.filter(t=>Number(t.ID)==Number(n))[0].Name,r=data_customer_mem.filter(n=>Number(n.ID)==Number(t))[0].Name;$("#helpchosing_program_CTKM_name").html(i);$("#helpchosing_program_CUSMEM_name").html(r)}}else help_program_changing_flag=1}function Tab_Detail_Loading_Program_By_Service(n,t,i,r){let e=0,u=[],f=n.filter(n=>Number(n.ID)==Number(i));return f!=undefined&&f.length==1&&(e=Number(f[0].CatID)),i!=0&&t!=undefined&&(u=t.filter(n=>Tab_Detail_Checking_Service_InJSON(i,e,n.Rule)==!0)),Load_Combo(u,r,!1),u!=undefined&&u.length!=0?u[0].ID:0}function Tabdetail_ProValue(n,t,i,r,u){try{let f={};if(f.amount=0,f.percent=0,Number(i)!=0){let h=0,e,o,s,c="[]",v=0,l=n.filter(n=>Number(n.ID)==Number(r));l!=undefined&&l.length==1&&(v=Number(l[0].CatID));let a=t.filter(n=>Number(n.ID)==Number(i));if(a!=undefined&&a.length==1&&(c=a[0].Rule),c!=""&&c!="[]"){let n=JSON.parse(c);n!=undefined&&n!=null&&n.length>0&&(e=Tab_Detail_Get_Largest_Value_InJson(-1,n[0].active,n[0].amount,n[0].percent,n[0].value),o=Tab_Detail_Get_Largest_Value_InJson(v,n[1].active,n[1].amount,n[1].percent,n[1].value),s=Tab_Detail_Get_Largest_Value_InJson(r,n[2].active,n[2].amount,n[2].percent,n[2].value),e!="0"&&(Number(e.percent)*u/100>h||Number(e.amount)>h)&&(h=Number(e.percent)*u/100>Number(e.amount)?Number(e.percent)*u/100:Number(e.amount),f.percent=e.percent,f.amount=e.amount),o!="0"&&(Number(o.percent)*u/100>h||Number(o.amount)>h)&&(h=Number(o.percent)*u/100>Number(o.amount)?Number(o.percent)*u/100:Number(o.amount),f.percent=o.percent,f.amount=o.amount),s!="0"&&(Number(s.percent)*u/100>h||Number(s.amount)>h)&&(h=Number(s.percent)*u/100>Number(s.amount)?Number(s.percent)*u/100:Number(s.amount),f.percent=s.percent,f.amount=s.amount))}}return f}catch(f){return"0"}}function Tabdetail_ProResult(n,t,i,r){try{let u={};return u.result_percent=0,u.result_value=0,i.amount!=0?(u.result_value=r==1?i.amount:i.amount*t,u.result_percent=0):(u.result_value=n*i.percent/100,u.result_percent=i.percent),u}catch(u){return"0"}}function onTab_Program_Customer_Member(){if(tab_changing_flag==1){tab_changing_flag=0;let n=Number($("#DiscountCustomerMemberID").dropdown("get value"))?Number($("#DiscountCustomerMemberID").dropdown("get value")):0;n!=0&&($("#DiscountCustomerGroupID").dropdown("clear"),$("#discountTabCombo").dropdown("clear"));tab_changing_flag=1;Tab_Count_Price_For_All()}}function onTab_Program_Customer_Group(){if(tab_changing_flag==1){tab_changing_flag=0;let n=Number($("#DiscountCustomerGroupID").dropdown("get value"))?Number($("#DiscountCustomerGroupID").dropdown("get value")):0;n!=0&&($("#DiscountCustomerMemberID").dropdown("clear"),$("#discountTabCombo").dropdown("clear"));tab_changing_flag=1;Tab_Count_Price_For_All()}}function onTab_Program_CTKM(){if(tab_changing_flag==1){tab_changing_flag=0;let n=Number($("#discountTabCombo").dropdown("get value"))?Number($("#discountTabCombo").dropdown("get value")):0;n!=0&&($("#DiscountCustomerGroupID").dropdown("clear"),$("#DiscountCustomerMemberID").dropdown("clear"));tab_changing_flag=1;Tab_Count_Price_For_All()}}function onTab_Program_Voucher(){let n=Number($("#DiscountVoucherID").dropdown("get value"))?Number($("#DiscountVoucherID").dropdown("get value")):0;n!=0&&$("#DiscountCamVoucherID").dropdown("clear");Tab_Count_Price_For_All()}function onTab_Program_Voucher_KeyDown(n){n.which==13&&onTab_Program_Voucher_ByCode()}function onTab_Program_Voucher_PasteQR(n){catchPaste(n,this,function(n){onTab_Program_Voucher_ByCode(n)})}async function onTab_Program_Voucher_ByCode(n=""){return new Promise(t=>{setTimeout(()=>{let i=n!=""?n:$("#searchDiscountVoucher").val();if(i!=undefined&&i!=""){let n=data_voucher.find(n=>n.Code==i);n&&n.ID!=0&&($("#DiscountVoucherID").dropdown("refresh"),$("#DiscountVoucherID").dropdown("set selected",n.ID),$("#searchDiscountVoucher").val(""),setTimeout(()=>{$("#DiscountVoucherID").dropdown("hide")},300))}t()})})}function onTab_Program_VoucherCamVoucher(){let n=Number($("#DiscountCamVoucherID").dropdown("get value"))?Number($("#DiscountCamVoucherID").dropdown("get value")):0;n!=0&&$("#DiscountVoucherID").dropdown("clear");Tab_Count_Price_For_All()}function onTab_Program_CamVoucher_KeyDown(n){n.which==13&&onTab_Program_CamVoucher_ByCode()}function onTab_Program_CamVoucher_PasteQR(n){catchPaste(n,this,function(n){onTab_Program_CamVoucher_ByCode(n)})}async function onTab_Program_CamVoucher_ByCode(n=""){return new Promise(t=>{setTimeout(()=>{let i=n!=""?n:$("#Tabcamvou_Search").val();i!=undefined&&i!=""&&i.length>=6&&AjaxLoad(url="/Customer/Service/TabMulti/?handler=SearchVoucher",data={CustomerID:ser_MultiTabCustomerID,textSearch:i},async=!0,error=function(){notiError_SW()},success=function(n){if(n!="0"){let t=JSON.parse(n);t&&t.length>0&&(data_camvoucher[CurrentService_Choose]=t?t.reduce((n,t)=>(t.Name=`<span class="text-sm text-primary mb-0">${t.Code}</span> ${t.Name}`,n.push(t),n),[]):[],Tab_Detail_Loading_Program_By_Service(data_service_root,t,CurrentService_Choose,"ccbDiscountCamVoucherID"),$("#DiscountCamVoucherID").dropdown("refresh"),$("#DiscountCamVoucherID").dropdown("set selected",t[0]?.ID??0),Tab_Count_Price_For_All())}});t()})})}function Tab_Detail_Get_Largest_Value_InJson(n,t,i,r,u){try{let f={};if(f.amount=0,f.percent=0,Number(t)==1&&n==-1)f.amount=i,f.percent=r;else if(Number(t)==0)f.amount=0,f.percent=0;else if(u=="[]"||u=="")f=!1;else{let t=u.filter(t=>Number(t.id)==Number(n));t!=undefined&&t.length!=0&&(f.amount=t[0].amount,f.percent=t[0].percent)}return f}catch(f){return"0"}}function Tab_Detail_Checking_Service_InJSON(n,t,i){try{let o=!1,r=JSON.parse(i),u={},f={},e={};return r!=undefined&&r!=null&&r.length>0&&(u=r[0],f=r[1],e=r[2],o=Tab_Detail_Checking_Service_InJSON_Detail(-1,u.active,u.value)?!0:Tab_Detail_Checking_Service_InJSON_Detail(t,f.active,f.value)?!0:Tab_Detail_Checking_Service_InJSON_Detail(n,e.active,e.value)?!0:!1),o}catch(r){return!1}}function Tab_Detail_Checking_Service_InJSON_Detail(n,t,i){try{let r=!1;if(Number(t)==1&&n==-1)r=!0;else if(Number(t)==0)r=!1;else if(i=="[]"||i=="")r=!1;else{let t=i.filter(t=>Number(t.id)==Number(n));r=t!=undefined&&t.length!=0?!0:!1}return r}catch(r){return!1}}